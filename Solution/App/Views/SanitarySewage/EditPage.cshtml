
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "EditPage";
}


<div id="edit">
    <el-form v-model="editForm" v-bind:inline="true" label-position="right" label-width="100px" size="small">
        <div id="BasicInfo">
            <div class="titlecss">基本信息</div>
            <el-row type="flex">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="工程名称：" style="width:100%;">
                        <el-input v-model="editForm.S_NAME">
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="项目编号：">
                        <el-input v-model="editForm.S_PROJECT_NO">
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="年度：">
                        <el-select v-model="editForm.N_YEAR" class="selectwidth">
                            <el-option v-for="item in YearOption" v-bind:key="item.s_cd_key" v-bind:label="item.s_cd_value" v-bind:value="item.s_cd_key" v-on:change="changeYear">
                            </el-option>
                        </el-select>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row type="flex">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="工程分类：">
                       农村生活污水
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="工程状态：">
                        <el-select v-model="editForm.N_PACE_STATUS" class="selectwidth">
                            <el-option v-for="item in staticsOptions" v-bind:key="item.s_cd_key" v-bind:label="item.s_cd_value" v-bind:value="item.s_cd_key" v-on:change="changeStatics">
                            </el-option>
                        </el-select>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="所属镇：">
                        <el-select v-model="editForm.S_TOWN" class="selectwidth">
                            <el-option v-for="item in xzqhOptions" v-bind:key="item.s_cd_key2" v-bind:label="item.s_cd_value" v-bind:value="item.s_cd_value" v-on:change="changeXzqh">
                            </el-option>
                        </el-select>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="16" class="colheight el-col-16">
                    <el-form-item label="工程地址：">
                        <el-input v-model="editForm.S_ADDRESS" style="width:116.5%;">
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="项目法人：">
                        <el-select v-model="editForm.S_LEGAL_PERSON" class="selectwidth">
                            <el-option v-for="item in LegalPerOption" v-bind:key="item.s_id" v-bind:label="item.s_name" v-bind:value="item.s_name" v-on:change="changeLegalper">
                            </el-option>
                        </el-select>
                    </el-form-item>
                </el-col>
            </el-row>

            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="监理单位：">
                        <el-input v-model="editForm.S_UNIT_SUPERVISE">
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="施工单位：">
                        <el-input v-model="editForm.S_UNIT_BUILD">
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="设计单位：">
                        <el-select v-model="editForm.S_UNIT_DESIGN" class="selectwidth">
                            <el-option v-for="item in DesignUnitOption" v-bind:label="item.s_name" v-bind:value="item.s_id" v-on:change="changeDesignUnit">
                                @*v-bind:key="item.s_id"*@
                            </el-option>
                        </el-select>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="估算总投资：">
                        <el-input v-model="editForm.N_RECKON_TOTAL_AMT">
                            <span>万元</span>
                    </el-form-item>
                </el-col>
            </el-row>

            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="24">
                    <el-form-item label="备注：">
                        <el-input type="textarea" v-model="editForm.S_REMARK" style="width:78%;"></el-input>
                    </el-form-item>
                </el-col>
            </el-row>
        </div>

        <div id="ProjectInfo">
            <div class="titlecss"> 批复工程量</div>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="村组数量:">
                        <el-input v-model="editForm.N_CZSL">
                            <template slot="append">
                                个
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="总户数:">
                        <el-input v-model="editForm.N_ZHS">
                            <template slot="append">
                                户
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="就地处理户数:">
                        <el-input v-model="editForm.N_JDCLHS">
                            <template slot="append">
                                户
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="市政纳管户数:">
                        <el-input v-model="editForm.N_SZNGHS">
                            <template slot="append">
                                户
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="就地处理站:">
                        <el-input v-model="editForm.N_JDCLZ">
                            <template slot="append">
                                座
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="管网长度:">
                        <el-input v-model="editForm.N_GWCD">
                            <template slot="append">
                                公里
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="新翻建化粪池:">
                        <el-input v-model="editForm.N_XFJHFC">
                            <template slot="append">
                                座
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
            </el-row>
        </div>

        <div id="InvestInfo">
            <div class="titlecss">概算投资</div>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="总投资：">
                        <el-input v-model="editForm.N_TOTAL_INVEST">
                            <template slot="append">
                                万元
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="工程直接费：">
                        <el-input v-model="editForm.N_ENGIN_COST">
                            <template slot="append">
                                万元
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="独立费用：">
                        <el-input v-model="editForm.N_INDEPENDENT_COST">
                            <template slot="append">
                                万元
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="预备费：">
                        <el-input v-model="editForm.N_PREP_COST">
                            <template slot="append">
                                万元
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" label-position="right" class="colheight">
                    <el-form-item label="景观等费用：">
                        <el-input v-model="editForm.N_SIGHT_COST">
                            <template slot="append">
                                万元
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
            </el-row>
        </div>

        <div id="fundForm">
            <div class="titlecss">资金配套组成</div>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="市补:">
                        <el-input v-model="editForm.N_SUBSIDY_CITY">
                            <template slot="append">
                                万元
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="区配套:">
                        <el-input v-model="editForm.N_SUBSIDY_DISTRICT">
                            <template slot="append">
                                万元
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="镇配套:">
                        <el-input v-model="editForm.N_SUBSIDY_TOWN">
                            <template slot="append">
                                万元
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
            </el-row>
        </div>

        <div id="finishInfo">
            <div class="titlecss"> 完成工程量</div>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="村组数量:">
                        <el-input v-model="editForm.N_WCCZSL">
                            <template slot="append">
                                个
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="总户数:">
                        <el-input v-model="editForm.N_WCZHS">
                            <template slot="append">
                                户
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="就地处理户数:">
                        <el-input v-model="editForm.N_WCJDCLHS">
                            <template slot="append">
                                户
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="市政纳管户数:">
                        <el-input v-model="editForm.N_WCSZNGHS">
                            <template slot="append">
                                户
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="就地处理站:">
                        <el-input v-model="editForm.N_WCJDCLZ">
                            <template slot="append">
                                座
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="管网长度:">
                        <el-input v-model="editForm.N_WCGWCD">
                            <template slot="append">
                                公里
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row type="flex" class="rowpadding">
                <el-col v-bind:span="8" class="colheight">
                    <el-form-item label="新翻建化粪池:">
                        <el-input v-model="editForm.N_WCXFJHFC">
                            <template slot="append">
                                座
                            </template>
                        </el-input>
                    </el-form-item>
                </el-col>
            </el-row>
        </div>


        <div id="editInfo">
            <div class="titlecss">补充信息</div>
            <div>
                <span>工程图纸上传：</span>
                <el-button type="primary" size="small">点击上传 </el-button>
                <span> （支持word、jpg、png、dwg、zip、rar等格式文件上传；支持多文件上传）</span>
            </div>
            <div style="padding-top:20px;">
                <span>工程位置草图：</span>
                <el-button type="text">工程位置草图</el-button>
            </div>
            <el-dialog title="工程位置草图编辑" width="70%">
            </el-dialog>
            <div style="padding-top:20px;">
                <span>工程图片上传：</span>
            </div>
        </div>

        <div style="text-align:center;">
            <el-button style="width: 90px;" v-on:click="cancel" size="small"> 取消</el-button>
            <el-button type="primary" v-on:click="edit" style="width: 90px;" size="small">保存</el-button>
        </div>
    </el-form>
</div>

<script>
    new Vue({
        el: '#edit',
        data: {
            YearOption: [],
            staticsOptions: [],
            xzqhOptions: [],
            LegalPerOption: [],
            DesignUnitOption: [],

            editForm: {
                S_ID:'',
                S_NAME: '',
                N_TYPE: '',
                S_PROJECT_NO: '',
                N_YEAR: '',
                N_PACE_STATUS: '',
                S_TOWN: '',
                S_ADDRESS: '',
                S_LEGAL_PERSON: '',
                S_UNIT_DESIGN: '',
                S_UNIT_BUILD: '',
                S_UNIT_SUPERVISE: '',
                N_RECKON_TOTAL_AMT: '',
                S_REMARK: '',
                N_CZSL: '',
                N_ZHS: '',
                N_JDCLHS: '',
                N_SZNGHS: '',
                N_JDCLZ: '',
                N_GWCD: '',
                N_XFJHFC: '',
                N_TOTAL_INVEST: '',
                N_ENGIN_COST: '',
                N_INDEPENDENT_COST: '',
                N_PREP_COST: '',
                N_SIGHT_COST: '',
                N_SUBSIDY_CITY: '',
                N_SUBSIDY_DISTRICT: '',
                N_SUBSIDY_TOWN: '',
                N_WCCZSL: '',
                N_WCZHS: '',
                N_WCJDCLHS: '',
                N_WCSZNGHS: '',
                N_WCJDCLZ: '',
                N_WCGWCD: '',
                N_WCXFJHFC: '',
            }
        },
        mounted: function () {
            var t = this.GetId();
            this.GetDetail("/SanitarySewage/GetDetail", { id: t.id });

            this.getYear("/FarmlandWater/GetDictionary", { type: "年度" });
            this.getTown("/FarmlandWater/GetDictionary", { type: "街镇" });
            this.getStatics("/FarmlandWater/GetDictionary", { type: "工程状态" });
            this.getLegalPerson("/FarmlandWater/GetLegalPerson", null);
            this.getDesignUnit("/FarmlandWater/GetDesignUnit", null);
        },
        methods: {
            getYear: function (url, type) {
                axios.post(url, type)
                  .then(function (response) {
                      var tempData = JSON.parse(response.data);
                      var datas = tempData.DictionaryGetResponse.list;
                      this.YearOption = datas;
                  }.bind(this))
                  .catch(function (error) {
                      console.log(error);
                  });
            },
            getTown: function (url, type) {
                axios.post(url, type)
                  .then(function (response) {
                      var tempData = JSON.parse(response.data);
                      var datas = tempData.DictionaryGetResponse.list;
                      this.xzqhOptions = datas;
                  }.bind(this))
                  .catch(function (error) {
                      console.log(error);
                  });
            },
            getStatics: function (url, type) {
                axios.post(url, type)
                  .then(function (response) {
                      var tempData = JSON.parse(response.data);
                      var datas = tempData.DictionaryGetResponse.list;
                      this.staticsOptions = datas;
                  }.bind(this))
                  .catch(function (error) {
                      console.log(error);
                  });
            },
            getLegalPerson: function (url, param) {
                axios.post(url, param)
                  .then(function (response) {
                      var tempData = JSON.parse(response.data);
                      var datas = tempData.EnginLegalPersonListGetResponse.engin_unit_person_list;
                      this.LegalPerOption = datas;
                  }.bind(this))
                  .catch(function (error) {
                      console.log(error);
                  });
            },
            getDesignUnit: function (url, param) {
                axios.post(url, param)
                  .then(function (response) {
                      var tempData = JSON.parse(response.data);
                      var datas = tempData.EnginUnitListGetResponse.engin_unit_person_list;
                      this.DesignUnitOption = datas;
                  }.bind(this))
                  .catch(function (error) {
                      console.log(error);
                  });
            },
            changeYear: function (param) {
                this.editForm.N_YEAR = param;
            },
            changeStatics: function (param) {
                this.editForm.N_PACE_STATUS = param;
            },
            changeXzqh: function (param) {
                this.editForm.S_TOWN = param;
            },
            changeLegalper: function (param) {
                this.editForm.S_LEGAL_PERSON = param;
            },
            changeDesignUnit: function (param) {
                this.editForm.S_UNIT_DESIGN = param;
            },

            cancel: function () {
                window.location.href = "/SanitarySewage/Index";
            },
            edit: function () { },
            GetId: function () {
                var url = window.location.search;
                var theRequest = new Object();
                if (url.indexOf("?") != -1) {
                    var str = url.substr(1);
                    strs = str.split("&");
                    for (var i = 0; i < strs.length; i++) {
                        theRequest[strs[i].split("=")[0]] = decodeURI(strs[i].split("=")[1]);
                    }
                }
                return theRequest;
            },
            GetDetail: function (url, id) {
                axios.post(url, id)
                 .then(function (response) {
                     var li = JSON.parse(response.data);
                     this.editForm.S_ID = li.EnginSewageGetResponse.info.s_id;
                     this.editForm.S_NAME = li.EnginSewageGetResponse.info.s_name;
                     this.editForm.S_PROJECT_NO = li.EnginSewageGetResponse.info.s_project_no;
                     this.editForm.N_YEAR = li.EnginSewageGetResponse.info.n_year;
                     this.editForm.S_TOWN = li.EnginSewageGetResponse.info.s_town;
                     this.editForm.S_ADDRESS = li.EnginSewageGetResponse.info.s_address;
                     this.editForm.S_LEGAL_PERSON = li.EnginSewageGetResponse.info.s_legal_person;
                     this.editForm.S_UNIT_DESIGN = li.EnginSewageGetResponse.info.s_unit_design;
                     this.editForm.S_UNIT_BUILD = li.EnginSewageGetResponse.info.s_unit_build;
                     this.editForm.S_UNIT_SUPERVISE = li.EnginSewageGetResponse.info.s_unit_supervise;
                     this.editForm.N_RECKON_TOTAL_AMT = li.EnginSewageGetResponse.info.n_reckon_total_amt;
                     this.editForm.S_REMARK = li.EnginSewageGetResponse.info.s_remark;

                     this.editForm.N_CZSL = li.EnginSewageGetResponse.info.EnginMainSewage.n_czsl;
                     this.editForm.N_ZHS = li.EnginSewageGetResponse.info.EnginMainSewage.n_zhs;
                     this.editForm.N_JDCLHS = li.EnginSewageGetResponse.info.EnginMainSewage.n_jdclhs;
                     this.editForm.N_SZNGHS = li.EnginSewageGetResponse.info.EnginMainSewage.n_sznghs;
                     this.editForm.N_JDCLZ = li.EnginSewageGetResponse.info.EnginMainSewage.n_jdclz;
                     this.editForm.N_GWCD = li.EnginSewageGetResponse.info.EnginMainSewage.n_gwcd;
                     this.editForm.N_XFJHFC = li.EnginSewageGetResponse.info.EnginMainSewage.n_xfjhfc;

                     this.editForm.N_TOTAL_INVEST = li.EnginSewageGetResponse.info.EnginInvestmentSewage.n_total_invest;
                     this.editForm.S_UNIT_DESIGN = li.EnginSewageGetResponse.info.EnginInvestmentSewage.n_engin_cost;
                     this.editForm.N_INDEPENDENT_COST = li.EnginSewageGetResponse.info.EnginInvestmentSewage.n_independent_cost;
                     this.editForm.N_PREP_COST = li.EnginSewageGetResponse.info.EnginInvestmentSewage.n_prep_cost;
                     this.editForm.N_SIGHT_COST = li.EnginSewageGetResponse.info.EnginInvestmentSewage.n_sight_cost;

                     this.editForm.N_SUBSIDY_CITY = li.EnginSewageGetResponse.info.EnginCapitalSewage.n_subsidy_city;
                     this.editForm.N_SUBSIDY_DISTRICT = li.EnginSewageGetResponse.info.EnginCapitalSewage.n_subsidy_district;
                     this.editForm.N_SUBSIDY_TOWN = li.EnginSewageGetResponse.info.EnginCapitalSewage.n_subsidy_town;

                     this.editForm.N_WCCZSL = li.EnginSewageGetResponse.info.EnginCompleteSewage.n_complete_czsl;
                     this.editForm.N_WCZHS = li.EnginSewageGetResponse.info.EnginCompleteSewage.n_complete_zhs;
                     this.editForm.N_WCJDCLHS = li.EnginSewageGetResponse.info.EnginCompleteSewage.n_complete_jdclhs;
                     this.editForm.N_WCSZNGHS = li.EnginSewageGetResponse.info.EnginCompleteSewage.n_complete_sznghs;
                     this.editForm.N_WCJDCLZ = li.EnginSewageGetResponse.info.EnginCompleteSewage.n_complete_jdclz;
                     this.editForm.N_WCGWCD = li.EnginSewageGetResponse.info.EnginCompleteSewage.n_complete_gwcd;
                     this.editForm.N_WCXFJHFC = li.EnginSewageGetResponse.info.EnginCompleteSewage.n_complete_xfjhfc;

                     this.StatusToNum(li.EnginSewageGetResponse.info.n_pace_status);
                 }.bind(this))
                  .catch(function (error) {
                      console.log(error);
                  });
            },
            edit: function () {
                axios.post('/SanitarySewage/Edit',{ param: JSON.stringify(this.editForm) }
               ).then(function (response) {
                   debugger
                   var datas = JSON.parse(response.data);
                   if (datas.EnginSewageUpdateResponse.result == true) {
                       alert("修改成功！");
                       window.location.href = "/SanitarySewage/Index";
                   }
               });
            },
            StatusToNum: function (status) {
                switch (status) {
                    case '工前准备':
                        this.editForm.N_PACE_STATUS = 1;
                        break;
                    case '开工':
                        this.editForm.N_PACE_STATUS = 10;
                        break;
                    case '完工':
                        this.editForm.N_PACE_STATUS = 20;
                        break;
                    case '完工验收':
                        this.editForm.N_PACE_STATUS = 30;
                        break;
                    case '决算审批':
                        this.editForm.N_PACE_STATUS = 40;
                        break;
                    case '竣工验收':
                        this.editForm.N_PACE_STATUS = 50;
                        break;
                    case '工程完结':
                        this.editForm.N_PACE_STATUS = 60;
                        break;
                    default:
                        break;
                }
            },
        }
    });
</script>

<style>
    #edit input, textarea {
        max-width: none;
        width: 100%;
    }

    #edit .el-form-item {
        width: 100%;
    }

    #edit .el-form-item__content {
        width: 70%;
    }

    #edit .el-input {
        width: 90%;
    }

    #edit {
        width: 100%;
        height: 95%;
        padding: 20px;
        font-size: 14px;
        min-width:1020px;
    }

    .titlecss {
        font-size: 18px;
        font-weight: bold;
    }

    .rowpadding {
        padding-bottom: 10px;
    }

    .colheight {
        height: 40px;
    }

    .selectwidth {
        width: 100%;
    }

   #edit .el-col-16 {
        width: 66.6%;
    }
</style>

